# StrictBoss Telegram Bot

Бот на `python-telegram-bot` для контроля двух пользователей по расписанию.

## Возможности
- Белый список из 2 пользователей.
- Загрузка недельного календаря командой `/upload`:
  - текстом (`YYYY-MM-DD HH:MM | Действие` или `YYYY-MM-DD HH:MM-HH:MM | Действие`),
  - или файлом `.ics` (экспорт календаря).
  - повторяющиеся события из `.ics` (`RRULE`: каждый день/неделя и т.д.) тоже учитываются.
  - при загрузке `.ics` сохраняются только события от дня загрузки и на 7 дней вперед.
  - если отправить несколько недель сразу, бот сам разобьет и сохранит по неделям.
  - если расписание не изменилось, можно не загружать повторно (старый календарь сохраняется).
- Уведомление второму игроку по каждому событию с кнопками `Да/Нет`.
- При `Нет` начисляется штраф (по умолчанию 100 руб) и копится банк.
- Напоминание в воскресенье в 19:00 (Asia/Novosibirsk) о загрузке календаря на следующую неделю.
- В воскресном напоминании отправляется таблица нарушений за текущую неделю.
- Админ-панель `/panel`: изменение штрафа, банк, статистика.
- Команда `/myid` для получения своего Telegram ID.
- Команда `/today` для вывода дел на день (свои и коллеги).
- В `/start` выводится статус активного календаря и список дел на сегодня.

## Команды
- `/start` - список основных команд.
- `/upload` - загрузить календарь на неделю.
- `/panel` - админ-панель.
- `/setfine` - задать штраф вручную числом (админ).
- `/stats` - моя статистика.
- `/stats_other` - статистика второго игрока.
- `/today` - дела на сегодня (свои и коллеги).
- `/violations` - мои открытые нарушения.
- `/pay <id>` - закрыть конкретное нарушение.
- `/payall` - закрыть все открытые нарушения.
  - в `/violations` доступны inline-кнопки `Закрыть` для быстрого закрытия без ввода ID.
- `/bank` - банк по штрафам (админ).
- `/myid` - показать мой Telegram ID.
- `/help` - справка по формату календаря.

Админ может управлять долгом второго пользователя:
- `/violations <user_id>`
- `/pay <violation_id> <user_id>`
- `/payall <user_id>`

## Запуск
1. Установи зависимости:
```bash
pip install -r requirements.txt
```
2. Задай переменные окружения (см. `.env.example`).
3. Создай файл `.env` (можно копией `.env.example`) и заполни `BOT_TOKEN`.
4. Запусти:
```bash
python main.py
```

## Формат календаря
Каждая строка отдельным событием:
- `YYYY-MM-DD HH:MM | Действие`
- `YYYY-MM-DD HH:MM-HH:MM | Действие`
- или `DD.MM HH:MM | Действие`
- или `DD.MM HH:MM-HH:MM | Действие`
Можно загрузить сразу несколько недель, бот сохранит их отдельно.

Пример:
```
2026-02-16 08:00 | Зарядка
16.02 22:30 | Отбой
```
